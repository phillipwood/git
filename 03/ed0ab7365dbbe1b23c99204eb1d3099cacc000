Changes since rfc:
 - Split these changes into a separate commit.
 - Detect blank lines when processing the indentation rather than
   parsing each line twice.
 - Tweaked the test to make it harder as suggested by Stefan.
 - Added timing data to the commit message.
