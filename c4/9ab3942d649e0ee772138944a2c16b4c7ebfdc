Changes since v1:
 - simplified code as suggested by Martin Ã…gren
