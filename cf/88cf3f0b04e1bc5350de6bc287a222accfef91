changes since v4:
 - use a separate if clause to handle with "\ No newline at end of
   file" lines rather than crowbarring them into the "+" line
   handling.
