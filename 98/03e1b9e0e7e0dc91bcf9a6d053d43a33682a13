changes since v3:

 - Reverted the implementation to v2 with more robust detection of the
   missing "'" on the last line of the author script based on a
   suggestion by Eric. This means that this series needs to progress
   closely with Eric's series of fixes or the fallback code will never
   be called.

- Tweaked the last test
